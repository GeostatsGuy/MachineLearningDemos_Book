

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Convolutional Neural Networks &#8212; Applied Machine Learning in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'MachineLearning_CNN';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Autoencoder" href="MachineLearning_autoencoder.html" />
    <link rel="prev" title="Artificial Neural Networks" href="MachineLearning_ANN.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/AppliedMachineLearning.jpg" class="logo__image only-light" alt="Applied Machine Learning in Python - Home"/>
    <script>document.write(`<img src="_static/AppliedMachineLearning.jpg" class="logo__image only-dark" alt="Applied Machine Learning in Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_concepts.html">Machine Learning Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_training_tuning.html">Training and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_workflow_construction.html">Workflow Construction and Coding</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_probability.html">Probability Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_plotting_data_models.html">Loading and Plotting Data and Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_univariate_analysis.html">Univariate Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_multivariate_analysis.html">Multivariate Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_feature_transformations.html">Feature Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_feature_ranking.html">Feature Ranking</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_feature_imputation.html">Feature Imputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_clustering.html">Cluster Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_density-based_clustering.html">Density-based Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_spectral_clustering.html">Spectral Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_PCA.html">Principal Components Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_multidimensional_scaling.html">Multidimensional Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_random_projection.html">Random Projection</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_predictive.html">Prediction with scikit-learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_linear_regression.html">Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_ridge_regression.html">Ridge Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_LASSO_regression.html">LASSO Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_Bayesian_linear_regression.html">Bayesian Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_naive_Bayes.html">Naive Bayes</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_polynomial_regression.html">Polynomial Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_knearest_neighbours.html">k-Nearest Neighbours</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_decision_tree.html">Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_ensemble_trees.html">Bagging Tree and Random Forest</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_gradient_boosting.html">Gradient Boosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_support_vector_machines.html">Support Vector Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_ANN.html">Artificial Neural Networks</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_autoencoder.html">Autoencoder Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_GAN.html">Generative Adversarial Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_time_series.html">Time Series Analysis and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_python.html">Python Code Snippets</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_datasets.html">Synthetic Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="conclusions.html">Conclusions</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning_glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/GeostatsPyDemos_Book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/GeostatsPyDemos_Book/issues/new?title=Issue%20on%20page%20%2FMachineLearning_CNN.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/MachineLearning_CNN.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Convolutional Neural Networks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts-in-common-with-artificial-neural-networks">Concepts in Common with Artificial Neural Networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolutional-neural-networks-concepts">Convolutional Neural Networks Concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#image-data-with-artificial-neural-networks">Image Data with Artificial Neural Networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regularization-for-cnns">Regularization for CNNs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-blocks-for-cnns">Building Blocks for CNNs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#activation-functions">Activation Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pooling">Pooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-wise-pooling">Depth-wise Pooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#common-cnn-architecture">Common CNN Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#by-hand-cnn-architecture">By-Hand CNN Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-model-parameters">Training Model Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backpropagation">Backpropagation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updating-model-parameters">Updating Model Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-epochs">Training Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-with-multiple-training-images">Training with Multiple Training Images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-pass">Forward Pass</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-required-packages">Import Required Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#declare-functions">Declare Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-simple-by-hand-cnn">The Simple By-hand CNN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-by-hand-cnn">Visualize By-hand CNN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-synthetic-training-images-with-label">Make Synthetic Training Images with Label</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-simple-cnn-on-many-training-images">Training the Simple CNN on Many Training Images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comments">Comments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-the-author">About the Author</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#want-to-work-together">Want to Work Together?</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <figure style="text-align: center;">
  <img src="_static/intro/title_page.png" style="display: block; margin: 0 auto; width: 100%;">
</figure>
<section id="convolutional-neural-networks">
<h1>Convolutional Neural Networks<a class="headerlink" href="#convolutional-neural-networks" title="Permalink to this heading">#</a></h1>
<p>Michael J. Pyrcz, Professor, The University of Texas at Austin</p>
<p><a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
<p>Chapter of e-book “Applied Machine Learning in Python: a Hands-on Guide with Code”.</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite this e-Book as:</p>
<p>Pyrcz, M.J., 2024, <em>Applied Machine Learning in Python: A Hands-on Guide with Code</em> [e-book]. Zenodo. doi:10.5281/zenodo.15169138 <a class="reference external" href="https://doi.org/10.5281/zenodo.15169138"><img alt="DOI" src="https://zenodo.org/badge/863274676.svg" /></a></p>
</div>
<p>The workflows in this book and more are available here:</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite the MachineLearningDemos GitHub Repository as:</p>
<p>Pyrcz, M.J., 2024, <em>MachineLearningDemos: Python Machine Learning Demonstration Workflows Repository</em> (0.0.3) [Software]. Zenodo. DOI: 10.5281/zenodo.13835312. GitHub repository: <a class="github reference external" href="https://github.com/GeostatsGuy/MachineLearningDemos">GeostatsGuy/MachineLearningDemos</a> <a class="reference external" href="https://zenodo.org/doi/10.5281/zenodo.13835312"><img alt="DOI" src="https://zenodo.org/badge/862519860.svg" /></a></p>
</div>
<p>By Michael J. Pyrcz <br />
© Copyright 2024.</p>
<p>This chapter is a tutorial for / demonstration of <strong>Convolutional Neural Networks</strong>.</p>
<p><strong>YouTube Lecture</strong>: check out my lectures on:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://youtu.be/A9PiCMY_6nM?si=NxWSU_5RgQ4w55EL">Artificial Neural Networks</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/za2my_XDoOs?si=LeHU6p2_fc9dX4Yt">Convolutional Neural Networks</a></p></li>
</ul>
<p>These lectures are all part of my <a class="reference external" href="https://youtube.com/playlist?list=PLG19vXLQHvSC2ZKFIkgVpI9fCjkN38kwf&amp;si=XonjO2wHdXffMpeI">Machine Learning Course</a> on YouTube with linked well-documented Python workflows and interactive dashboards. My goal is to share accessible, actionable, and repeatable educational content. If you want to know about my motivation, check out <a class="reference external" href="https://michaelpyrcz.com/my-story">Michael’s Story</a>.</p>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this heading">#</a></h2>
<p>Convolutional neural networks are very powerful, nature inspired computing deep learning method based on an analogy of visual cortex extending the ability of our artificial neural networks to better work with images.</p>
<p>Nature inspired computing is looking to nature for inspiration to develop novel problem-solving methods,</p>
<ul class="simple">
<li><p><strong>artificial neural networks</strong> are inspired by biological neural networks</p></li>
<li><p><strong>nodes</strong> in our model are artificial neurons, simple processors</p></li>
<li><p><strong>connections</strong> between nodes are artificial synapses</p></li>
<li><p><strong>perceptive fields</strong> regularization to improve generalization and efficiency</p></li>
</ul>
<p>intelligence emerges from many connected simple processors. For the remainder of this chapter, I will used the terms nodes and connections to describe our convolutional neural network.</p>
</section>
<section id="concepts-in-common-with-artificial-neural-networks">
<h2>Concepts in Common with Artificial Neural Networks<a class="headerlink" href="#concepts-in-common-with-artificial-neural-networks" title="Permalink to this heading">#</a></h2>
<p>Here are some key aspects of artificial neural networks (ANNs),</p>
<p><strong>Basic Design</strong> - <em>“…a computing system made up of a number of simple, highly interconnected processing elements, which process information by their dynamic state response to external inputs.”</em> Caudill (1989).</p>
<p><strong>Still a Prediction Model</strong> - while these models may be quite complicated with even millions of trainable model parameters, weights and biases, they are still a function that maps from predictor features to response features,</p>
<div class="math notranslate nohighlight">
\[
Y=f(X)+\epsilon
\]</div>
<p><strong>Supervised learning</strong> – we provide training data with predictor features, <span class="math notranslate nohighlight">\(X_1,\ldots,𝑋_𝑚\)</span> and response feature(s), <span class="math notranslate nohighlight">\(𝑌_1,\ldots,𝑌_K\)</span>, with the expectation of some model prediction error, <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p>
<p><strong>Nonlinearity</strong> - nonlinearity is imparted to the system through the application of nonlinear activation functions to model nonlinear relationships</p>
<p><strong>Universal Function Approximator (Universal Approximation Theorem)</strong> - artificial neural networks have the ability to learn any possible function shape of <span class="math notranslate nohighlight">\(f\)</span> over an interval, for an arbitrary wide (single hidden layer) by Cybenko (1989) and arbitrary depth by Lu and others (2017)</p>
<p>For brevity, I will not repeat all the fundamental concepts from the artificial neural network chapter.</p>
<ul class="simple">
<li><p>it may be a good idea to review that chapter before starting with this one</p></li>
</ul>
</section>
<section id="convolutional-neural-networks-concepts">
<h2>Convolutional Neural Networks Concepts<a class="headerlink" href="#convolutional-neural-networks-concepts" title="Permalink to this heading">#</a></h2>
<p><strong>Regularization</strong> - artificial neural networks are prone to overfitting; therefore, we need a form of regularization to prevent this</p>
<ul class="simple">
<li><p>for example, ridge and LASSO integrate regularization into the loss function through the shrinkage term to reduce overfit</p></li>
</ul>
<p>With convolutional neural networks we take a different approach to regularization,</p>
<ul class="simple">
<li><p>with image data we have an implicit hierarchy / proximity and relative position of pixels, flattening our 2D images into 1D vectors to pass through multiple fully connected artificial neural network layers would destroy this information</p></li>
<li><p>so we remove, regularize to 0.0, all connections outside of perceptive fields to preserve proximity and relative position of pixels information while avoiding overfit</p></li>
<li><p>these perceptive fields are regularization through extraction of smaller pixel subsets and simpler patterns from the images</p></li>
</ul>
<p>Note, we also include dropout, random removal of connections, as another form of regularization</p>
</section>
<section id="image-data-with-artificial-neural-networks">
<h2>Image Data with Artificial Neural Networks<a class="headerlink" href="#image-data-with-artificial-neural-networks" title="Permalink to this heading">#</a></h2>
<p>We could use image data with our artificial neural networks.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/annimage.png" style="display: block; margin: 0 auto; width: 90%;">
  <figcaption style="text-align: center;"> Illustration of artificial neural network to classify an image.
</figcaption>
</figure>
<p>What is the issue with this approach?</p>
<ol class="arabic simple">
<li><p><strong>Massive number of model parameters</strong> - the model will likely be difficult to train and overfit.</p></li>
<li><p><strong>Very sensitive to location</strong> - we would like to learn from our images with location invariance, i.e., for the example above the location of the channels should not matter.</p></li>
<li><p><strong>Flattening the image to a vector</strong> - this is required by a artificial neural network, but if we first flatten our images to a vector we lose important information about the inter-pixel patterns, ordering, adjacency, etc.</p></li>
</ol>
<p>In summary, artificial neural networks are very inefficient for images and overfit and don’t generalize well! Instead, let’s be inspired by our visual cortex, with our vision we do not perceive all ‘pixels’, instead we segment the field of view into receptive fields.</p>
<ul class="simple">
<li><p>we extraction of features of interest from overlapping receptive fields, over a hierarchy (not shown) and then recompose the whole image, our perception.</p></li>
<li><p>we don’t perceive all the ‘pixels’ that would be exhausting for our brains, instead our visual cortex interprets and summarizes patterns.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/receptivefield.png" style="display: block; margin: 0 auto; width: 90%;">
  <figcaption style="text-align: center;"> Illustration of overlapping receptive fields to break up a field of view, summarize each part and recombine into our perception.
</figcaption>
</figure>
<p>Now let’s compare artificial neural networks and convolutional neural networks with this concept of receptive fields.</p>
<p>Fully Connected, Feed Forward Artificial Neural Network</p>
<ul class="simple">
<li><p>nodes in the next layer are connected to all nodes of the previous layer</p></li>
<li><p>spatial information is lost, the image data is immediately flattened to a 1D vector and adjacency / ordering information is lost</p></li>
</ul>
<p>Regularized with Receptive Fields Convolutional Neural Networks</p>
<ul class="simple">
<li><p>nodes in the next layer are mapped to specific regions of the previous layer, an image or feature map</p></li>
<li><p>spatial information is preserved, data retains the original image 2D or 3D dimensionality in each layer, called feature maps.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/receptivefield2.png" style="display: block; margin: 0 auto; width: 60%;">
  <figcaption style="text-align: center;"> Illustration of overlapping receptive fields to break up a field of view, summarize each part and recombine into our perception.
</figcaption>
</figure>
</section>
<section id="regularization-for-cnns">
<h2>Regularization for CNNs<a class="headerlink" href="#regularization-for-cnns" title="Permalink to this heading">#</a></h2>
<p>Let’s do a quick recall on the concept of regularization for predictive machine learning models,</p>
<p><strong>Regularization</strong> - a constraint to reduce the sensitivity of the model to the data, i.e., to reduce model variance</p>
<p><strong>Regularization with Receptive Fields</strong> - the use of receptive fields is a form of regularization, resulting in,</p>
<ul class="simple">
<li><p>massive reduction in connections, weights / model parameters</p></li>
<li><p>effectively shrinking these potential weights to zero</p></li>
</ul>
<p>While integrating / focusing on pixel patterns!</p>
<p><strong>Regularization with Dropout</strong> - during training epochs, randomly ignore or “drop out” a proportion of nodes.
Each training epoch sees a different version / subset of the network</p>
<ul class="simple">
<li><p>an additional form of regularization for CNN to prevent specific nodes from dominating the model</p></li>
<li><p>simulates training multiple models and averaging like ensemble learning. Note, it is generally not feasible to train multiple networks in parallel to apply the ensemble to calculate the prediction (like random forest) and after training all nodes are used.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/dropout.png" style="display: block; margin: 0 auto; width: 60%;">
  <figcaption style="text-align: center;"> Illustration of dropout to remove random connects from receptive field to nodes in the feature map.
</figcaption>
</figure>
<p><strong>Batch Normalization</strong> - standardize the nodes’ inputs / weights over a layer to center and rescale (mean of 0 and variance of 1) to optimize activation function sensitivity and model parameter training.</p>
<div class="math notranslate nohighlight">
\[
\hat{x}_i \leftarrow \frac{x_i - \mu_B}{\sqrt{\sigma_B^2 + \epsilon}}
\]</div>
<p>Then we add 2 model parameters, layer standard deviation, <span class="math notranslate nohighlight">\(\gamma\)</span>, and mean, <span class="math notranslate nohighlight">\(\beta\)</span>, to add control to improve the optimality of the train individual weights in the next layer.</p>
<div class="math notranslate nohighlight">
\[
y_i \leftarrow \gamma \hat{x}_i + \beta
\]</div>
</section>
<section id="building-blocks-for-cnns">
<h2>Building Blocks for CNNs<a class="headerlink" href="#building-blocks-for-cnns" title="Permalink to this heading">#</a></h2>
<p>We have various operators to move from layer to layer (feature maps to feature maps) in our convolutional neural networks. The common operators include,</p>
<ul class="simple">
<li><p><strong>Convolution</strong> – a weighting window, kernel / filter designed to extract spatial information</p></li>
<li><p><strong>Pooling</strong> – reduction in dimensionality, increase local translation invariance</p></li>
<li><p><strong>Depth-wise Pooling, Down Sampling</strong> – 1x1 filter that combine channels / feature maps to learn over multiple kernels</p></li>
<li><p><strong>Activation</strong> – use of an activation function to apply a nonlinear transformation to impart nonlinearity to the system and to prevent collapse of the system to a simple linear model</p></li>
<li><p><strong>Full-connected, Feed Forward</strong> – see previous lecture on artificial neural networks</p></li>
</ul>
<p>Now we will describe, interpret and demonstrate these operators.</p>
</section>
<section id="convolution">
<h2>Convolution<a class="headerlink" href="#convolution" title="Permalink to this heading">#</a></h2>
<p>Convolution is the integral product of two functions, after one is reversed and shifted by <span class="math notranslate nohighlight">\(\Delta\)</span>.</p>
<ul class="simple">
<li><p>one interpretation is smoothing a function with weighting function, <span class="math notranslate nohighlight">\(𝑓(\Delta)\)</span>, is applied to calculate the weighted average of function, <span class="math notranslate nohighlight">\(𝑔(x)\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ 
(f * g)(x) = \int_{-\infty}^{\infty} f(\Delta) g(x - \Delta) \, d\Delta 
\]</div>
<p>this easily extends into any dimensionality, for example 2D for images,</p>
<div class="math notranslate nohighlight">
\[
(f * g)(x, y) = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(\Delta_x, \Delta_y) g(x - \Delta_x, y - \Delta_y) \, d\Delta_x \, d\Delta_y
\]</div>
<p>The choice of which function is shifted before integration does not change the result, the convolution operator has commutativity,</p>
<div class="math notranslate nohighlight">
\[ 
(f * g)(x) = \int_{-\infty}^{\infty} f(\Delta) g(x - \Delta) \, d\Delta 
\]</div>
<div class="math notranslate nohighlight">
\[
(f * g)(x) = \int_{-\infty}^{\infty} f(x - \Delta) g(\Delta) \, d\Delta 
\]</div>
<ul class="simple">
<li><p>if either function is reflected then convolution is equivalent to cross-correlation, measure of similarity between 2 signals as a function of displacement.</p></li>
</ul>
<p>To demonstrate convolution with an exhaustive <span class="math notranslate nohighlight">\(g(x)\)</span> and sparsely sampled <span class="math notranslate nohighlight">\(g(x)\)</span> I built out an <a class="reference external" href="https://github.com/GeostatsGuy/DataScienceInteractivePython/blob/main/Interactive_Convolution_kNearest.ipynb">interactive Python convolution dashboard</a>,</p>
<figure style="text-align: center;">
  <img src="_static/knearest/interactive_convolution.png" style="display: block; margin: 0 auto; width: 100%;">
  <figcaption style="text-align: center;">Interactive Python dashboard to demonstrate convolution.</figcaption>
</figure>
<p>For convolution operations, a trainable weighting function, <span class="math notranslate nohighlight">\(g(\Tau)\)</span>, is learned during model training.</p>
<p><strong>Filter/Kernel</strong> – the weights assigned over the convolution window to calculate the next feature map. By training the weights the filter(s) may extract specific spatial features.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/convolutioneg.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Two examples of convolution calculations.
.</figcaption>
</figure>
<p>Let’s look at a specific kernel form, the blur filter.</p>
<ul class="simple">
<li><p>the next feature map receives the local averages over the previous feature map or image.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/blurkernel.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Example filter, the blur / local average filter.</figcaption>
</figure>
<p>Some observations about the filters,</p>
<ul class="simple">
<li><p>size of the filter is related to the scale of the features that we are extracting</p></li>
<li><p>larger kernels increase the number of connections, model weights and ultimately the computational complexity</p></li>
<li><p>odd numbers for kernel size to avoid distortion, asymmetric kernels are possible</p></li>
<li><p>sum to one prevent bias (shifting in the mean from one image or feature map to another feature map</p></li>
</ul>
<p><strong>Padding</strong> - our next feature map has a reduced size by 1 on all the edges to avoid the overlapping outside the feature map, i.e., no padding, while padding extrapolates outside the feature map or image, preventing reduction in size of the next feature map.</p>
<ul class="simple">
<li><p>there are varirous methods for padding, including assuming zero, constant value, and nearest value in feature map.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/padding.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Convolution without padding, resulting in feature map size reduction (above) and convolution with padding (assuming 0 outside the feature map) for no feature map size reduction (below).</figcaption>
</figure>
<p><strong>Stride</strong> - the steps of the convolution filter / kernel through the previous feature map.</p>
<ul class="simple">
<li><p>for a stride of 1 there is no implicit reduction in feature map size.</p></li>
<li><p>for a stride of &gt; 2 there is a reduction in feature map size.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/stride.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Convolution with stride of 1 (above) and convolution with a stride of 2 (below) with a reduction in feature map size.</figcaption>
</figure>
<p><strong>Size of Next Feature Map</strong> - the next feature map size is determined by the hyperparameters, previous feature map size, <span class="math notranslate nohighlight">\(n_{in}\)</span>, convolution kernel size, <span class="math notranslate nohighlight">\(k\)</span>, convolution padding size, <span class="math notranslate nohighlight">\(p\)</span> and convolution stride size, <span class="math notranslate nohighlight">\(s\)</span>, by this equation,</p>
<div class="math notranslate nohighlight">
\[
n_{\text{out}} = \left\lfloor \frac{n_{\text{in}} + 2p - k}{s} \right\rfloor + 1
\]</div>
<p>For example, if,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n_{in} = 4\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(k = 2\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(p = 0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(s = 1\)</span></p></li>
</ul>
<p>Then we can substitute into the equation,</p>
<div class="math notranslate nohighlight">
\[
n_{\text{out}} = \left\lfloor \frac{4 + 2(0) - 2}{1} \right\rfloor + 1 = 3
\]</div>
<p>Now compare this to a visualization of this example,</p>
<figure style="text-align: center;">
  <img src="_static/CNN/featuremapsize.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Example kernel, input and output feature maps for the example above.</figcaption>
</figure>
<p>We calculate the next feature map size as:</p>
<div class="math notranslate nohighlight">
\[
n_{\text{out}} = \left\lfloor \frac{4 + 2(0) - 2}{1} \right\rfloor + 1 = 3
\]</div>
<p><strong>Filter / Kernel Design</strong> – by training the weights the filter may extract specific features. Consider these example filter types with simple 1D examples of input and output feature ‘maps’.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/filtertypes.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Filters (above, and 1D illustrations of convolution, original function (black) and convolution (red) (below).</figcaption>
</figure>
<p><strong>Multiple Filters / Kernels</strong> - typically multiple filters, <span class="math notranslate nohighlight">\(n_k\)</span>, are trained on each convolutional layer to extract various structures from the image.</p>
<ul class="simple">
<li><p>this increases feature map depth or channels, <span class="math notranslate nohighlight">\(n_k\)</span></p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/filters.png" style="display: block; margin: 0 auto; width: 30%;">
  <figcaption style="text-align: center;">Feature map has a depth, also known as number of channels, $n_k$ due to application of more than 1 filter to the previous image or feature map. 
.</figcaption>
</figure>
<ul class="simple">
<li><p>note, the original image may have multiple channels, depth &gt; 1, for example, a RGB image with 3 channels, one for each red, blue and green.</p></li>
</ul>
<p>Finally here are some examples of convolution filters applied to an image of a brick wall on The University of Texas at Austin, codes are available at <a class="reference external" href="https://github.com/GeostatsGuy/PythonNumericalDemos/blob/master/SubsurfaceDataAnalytics_Convolution_Operators.ipynb">SubsurfaceDataAnalytics_Convolution_Operators.ipynb.</a>.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/convolutionwall.png" style="display: block; margin: 0 auto; width: 100%;">
  <figcaption style="text-align: center;">Convolution examples from a brick wall on the campus of The University of Texas at Austin.
.</figcaption>
</figure>
</section>
<section id="activation-functions">
<h2>Activation Functions<a class="headerlink" href="#activation-functions" title="Permalink to this heading">#</a></h2>
<p>See the artificial neural network chapter for more details, but for a reminder considerations for selecting activation functions,</p>
<ul class="simple">
<li><p><strong>Nonlinear</strong> – required to impose nonlinearity into the predictor. Proved to be a universal function approximator if at least 1 hidden layer (Cybenko, 1989).</p></li>
<li><p><strong>Range</strong> – finite for more stability gradient-based learning, infinite for more efficient training (but requires a slower learning rate)</p></li>
<li><p><strong>Continuously Differentiable</strong> – required for stable gradient-based optimization</p></li>
<li><p><strong>Smooth functions with Monotonic Derivative</strong> – may generalize better</p></li>
<li><p><strong>Monotonic</strong> – guaranteed convexity of error surface of a single layer model (global minimum for loss function)</p></li>
<li><p><strong>Approximates Identity at the Origin</strong> – well learn efficiently with the weights initialized with small random values</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/activationwall.png" style="display: block; margin: 0 auto; width: 100%;">
  <figcaption style="text-align: center;">Convolution examples from a brick wall on the campus of The University of Texas at Austin.
.</figcaption>
</figure>
</section>
<section id="pooling">
<h2>Pooling<a class="headerlink" href="#pooling" title="Permalink to this heading">#</a></h2>
<p>Summarization over a filter / kernel with a single value. The impact of pooling includes,</p>
<ul class="simple">
<li><p>down sample the detection of features in feature maps</p></li>
<li><p>reduces the dimensionality of the feature map</p></li>
<li><p>integrate translation invariance, pattern detection insensitive to location</p></li>
</ul>
<p>Two common pooling methods are average and max pooling.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/pooling.png" style="display: block; margin: 0 auto; width: 50%;">
  <figcaption style="text-align: center;">Schematic of pooling operation.</figcaption>
</figure>
<p>Here’s an example of pooling with a 2x2 filter and a stride of 2.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/poolingeg.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Example of pooling operation for reducing the extent of the feature map.</figcaption>
</figure>
<ul class="simple">
<li><p>with 2 x 2 filter, stride of 2 the dimension is reduced ½ per axis, ¼ for 2D images.</p></li>
<li><p>for example, the value of 16 is location independent within the filter. This introduces translational invariance.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/poolingwall.png" style="display: block; margin: 0 auto; width: 100%;">
  <figcaption style="text-align: center;">Max and average pooling examples from a brick wall on the campus of The University of Texas at Austin..</figcaption>
</figure>
</section>
<section id="depth-wise-pooling">
<h2>Depth-wise Pooling<a class="headerlink" href="#depth-wise-pooling" title="Permalink to this heading">#</a></h2>
<p>Summarization over feature maps with a single value.</p>
<ul class="simple">
<li><p>down sample the detection over feature maps</p></li>
<li><p>combine information learned from multiple kernels</p></li>
<li><p>reduces the depth of the feature map, next layer</p></li>
</ul>
<p>Two common pooling methods are average and max pooling.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/depthpooling.png" style="display: block; margin: 0 auto; width: 50%;">
  <figcaption style="text-align: center;">Schematic of depthwise pooling operation.</figcaption>
</figure>
</section>
<section id="common-cnn-architecture">
<h2>Common CNN Architecture<a class="headerlink" href="#common-cnn-architecture" title="Permalink to this heading">#</a></h2>
<p>The following is a common workflow for convolutional neural networks,</p>
<figure style="text-align: center;">
  <img src="_static/CNN/flowchart.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">The common CNN workflow.</figcaption>
</figure>
<p>We can illustrate this common workflow with an illustration of the common architecture.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/cnngeneral.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">The common CNN architecture.</figcaption>
</figure>
</section>
<section id="by-hand-cnn-architecture">
<h2>By-Hand CNN Architecture<a class="headerlink" href="#by-hand-cnn-architecture" title="Permalink to this heading">#</a></h2>
<p>Just like the artificial neural network chapter, I build a simple convolutional neural network by-hand.</p>
<p>For simplicity and brevity, I have made the following architectural choices,</p>
<ul class="simple">
<li><p>1D images with height of 5</p></li>
<li><p>1 convolutional layer with 1 kernel of size 3</p></li>
<li><p>activation with sigmoid</p></li>
<li><p>stride of 1 and no padding so the feature map has a size of 3</p></li>
<li><p>artificial neural network from feature map immediately to output node with linear activation</p></li>
</ul>
<p>This minimalist architecture demonstrates many of the salient concepts for convolutional neural networks while being very easy to visualize and very fast to train.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/cnnegschematic.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Schematic illustration of our by-hand CNN.</figcaption>
</figure>
<p>Now, we convert this schematic of our by-hand CNN to a diagram of the actual nodes.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/cnnegnodes.png" style="display: block; margin: 0 auto; width: 80%;">
  <figcaption style="text-align: center;">Architecture of our by-hand CNN.</figcaption>
</figure>
<p>To demonstrate the practicality of working with this architecture, let’s add the labels of the model parameters,</p>
<ul class="simple">
<li><p>kernel weights, <span class="math notranslate nohighlight">\(\lambda_6\)</span>, <span class="math notranslate nohighlight">\(\lambda_7\)</span>, and <span class="math notranslate nohighlight">\(\lambda_8\)</span></p></li>
<li><p>kernel bias, <span class="math notranslate nohighlight">\(b_{conv}\)</span></p></li>
<li><p>artificial neural network weights, <span class="math notranslate nohighlight">\(\lambda_{9,12}\)</span>, <span class="math notranslate nohighlight">\(\lambda_{10,12}\)</span>, and <span class="math notranslate nohighlight">\(\lambda_{11,12}\)</span></p></li>
<li><p>artificial neural network bias, <span class="math notranslate nohighlight">\(b_{12}\)</span></p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/cnnegpars.png" style="display: block; margin: 0 auto; width: 100%;">
  <figcaption style="text-align: center;">Architecture of our by-hand CNN with all trainable model parameters. Note, kernel weights are only shown in the first kernel position to avoid clutter.</figcaption>
</figure>
</section>
<section id="training-model-parameters">
<h2>Training Model Parameters<a class="headerlink" href="#training-model-parameters" title="Permalink to this heading">#</a></h2>
<p>Training  a convolutional neural network proceeds iteratively by these steps, the same as discussed in the artificial neural network chapter.</p>
<figure style="text-align: center;">
  <img src="_static/ANN/training_cycle.png" style="display: block; margin: 0 auto; width: 90%;">
  <figcaption style="text-align: center;"> Training an artificial neural network proceeds iteratively by, 1. forward pass to make a prediction, 2. calculate the error derivative based on the prediction and truth over training data, 3. backpropagate the error derivative back through the artificial neural network to calculate the derivatives of the error over all the model weights and biases parameters, 4. update the model parameters based on the derivatives and learning rates, 5. repeat until convergence.
</figcaption>
</figure>
<p>Here’s some details on each step with a focus on differences from artificial neural networks, for more details see the artificial neural network chapter.</p>
<ol class="arabic simple" start="0">
<li><p><strong>Initializing the Model Parameters</strong> - initialize all model parameters with typically small (near zero) random values. Here’s a couple common methods,</p></li>
</ol>
<ul class="simple">
<li><p><strong>Xavier Glorot Uniform Initialization</strong> - for Tanh and sigmoid activation, random realizations from uniform distributions specified by <span class="math notranslate nohighlight">\(U[\text{min}, \text{max}]\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_i = F_U\left[-\sqrt{\frac{6}{n_{\text{in}} + n_{\text{out}}}},\ \sqrt{\frac{6}{n_{\text{in}} + n_{\text{out}}}}\right]^{-1}(p^\ell)
\]</div>
<ul class="simple">
<li><p>where <span class="math notranslate nohighlight">\(F^{-1}_U\)</span> is the inverse of the CDF, <span class="math notranslate nohighlight">\(p\)</span> is the number of inputs, and <span class="math notranslate nohighlight">\(p^{\ell}\)</span> is a random cumulative probability value drawn from the uniform distribution, <span class="math notranslate nohighlight">\(U[0,1]\)</span>.</p></li>
</ul>
<p>For example, given a <span class="math notranslate nohighlight">\(3 \times 3\)</span> kernel with 1 channel in and 9 channel out,</p>
<div class="math notranslate nohighlight">
\[
n_{in} = k \times k \times C = 3 \times 3 \times 1
\]</div>
<div class="math notranslate nohighlight">
\[
n_out = k \times k \times  C = 3 \times 3 \times 9
\]</div>
<ul class="simple">
<li><p><strong>He Kaiming Weight Initialization</strong> - for ReLU and leaky ReLU activation, random realizations from uniform distributions specified by <span class="math notranslate nohighlight">\(U[\text{min}, \text{max}]\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_i = F_U\left[-\sqrt{\frac{6}{n_{\text{in}}}},\ \sqrt{\frac{6}{n_{\text{in}}}}\right]^{-1}(p^\ell)
\]</div>
<ul class="simple">
<li><p>where <span class="math notranslate nohighlight">\(F^{-1}_U\)</span> is the inverse of the CDF, <span class="math notranslate nohighlight">\(p\)</span> is the number of inputs, <span class="math notranslate nohighlight">\(k\)</span> is the number of outputs, and <span class="math notranslate nohighlight">\(p^{\ell}\)</span> is a random cumulative probability value drawn from the uniform distribution, <span class="math notranslate nohighlight">\(U[0,1]\)</span>.</p></li>
</ul>
<ol class="arabic simple">
<li><p><strong>Forward Pass</strong> - to make a prediction, <span class="math notranslate nohighlight">\(\hat{y}\)</span>. Initial predictions will be random for the first iteration, but will improve.</p></li>
</ol>
<figure style="text-align: center;">
  <img src="_static/ANN/first_prediction.png" style="display: block; margin: 0 auto; width: 70%;">
  <figcaption style="text-align: center;"> Prediction with our artificial neural network initialized with random model parameters, weights and biases.
</figcaption>
</figure>
<ol class="arabic simple" start="2">
<li><p><strong>Calculate the Error Derivative</strong> - given a loss of, <span class="math notranslate nohighlight">\(P = \frac{1}{2} \left(\hat{y} - y \right)^2\)</span>, the error derivative, i.e., rate of change of in error given a change in model estimate is <span class="math notranslate nohighlight">\(\frac{\partial P}{\partial \hat{y}} = \hat{Y} - Y\)</span>.</p></li>
</ol>
<ul class="simple">
<li><p>For now, let’s only consider a single estimate, and we will address more than 1 training data later.</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p><strong>Backpropagate the Error Derivative</strong> - we shift back through the artificial neural network to calculate the derivatives of the error over all the model weights and biases parameters, to accomplish this we use the chain rule,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\frac{\partial}{\partial x} f(g(h(x))) = \frac{\partial f}{\partial g} \cdot \frac{\partial g}{\partial h} \cdot \frac{\partial h}{\partial x}
\]</div>
<ol class="arabic simple" start="4">
<li><p><strong>Update the Model Parameters</strong> - based on the derivatives, \frac{\partial P}{\partial \lambda_{i,j}} and learning rates, <span class="math notranslate nohighlight">\(\eta\)</span>, like this,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\lambda_{i,j}^{\ell} = \lambda_{i,j}^{\ell - 1} + \eta \cdot \frac{\partial P}{\partial \lambda_{i,j}}
\]</div>
<ol class="arabic simple" start="5">
<li><p><strong>Repeat Until Convergence</strong> - return to step 1. until the error, <span class="math notranslate nohighlight">\(P\)</span>, is reduced to an acceptable level, i.e., model convergence is the condition to stop the iterations</p></li>
</ol>
</section>
<section id="backpropagation">
<h2>Backpropagation<a class="headerlink" href="#backpropagation" title="Permalink to this heading">#</a></h2>
<p>For brevity, I refer you to the artificial neural network chapter for a walkthrough of backpropagating the error gradient through a neural network.</p>
</section>
<section id="updating-model-parameters">
<h2>Updating Model Parameters<a class="headerlink" href="#updating-model-parameters" title="Permalink to this heading">#</a></h2>
<p>The derivatives for each of the model parameters are the error gradients, so we are ready to use gradient descent optimization with the addition of,</p>
<ul class="simple">
<li><p><strong>learning rate</strong> -  to scale the rate of change of the model updates we assign a learning rate, <span class="math notranslate nohighlight">\(\eta\)</span>. For our model parameter examples from above,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{9,12}^{\ell} = \lambda_{9,12}^{\ell - 1} - \eta \cdot \frac{\partial P}{\partial \lambda_{9,12}}
\]</div>
<div class="math notranslate nohighlight">
\[
\lambda_{10,12}^{\ell} = \lambda_{10,12}^{\ell - 1} - \eta \cdot \frac{\partial P}{\partial \lambda_{10,12}}
\]</div>
<div class="math notranslate nohighlight">
\[
b_{12}^{\ell} = b_{12}^{\ell - 1} + \eta \cdot \frac{\partial P}{\partial b_{12}}
\]</div>
<ul class="simple">
<li><p>recall, this process of gradient calculation and model parameters, weights and biases, updating is iterated and is known as gradient descent optimization.</p></li>
<li><p>the goal is to explore the loss hypersurface, avoiding and escaping local minimums and ultimately finding the global minimum.</p></li>
<li><p>learning rate, also known as step size is commonly set between 0.0 and 1.0, note 0.01 is the default in Keras module of TensorFlow</p></li>
<li><p><strong>Low Learning Rate</strong> – more stable, but a slower solution, may get stuck in a local minimum</p></li>
<li><p><strong>High Learning Rate</strong> – may be unstable, but perhaps a faster solution, may diverge out of the global minimum</p></li>
</ul>
<p>One strategy is to start with a high learning rate and then to decrease the learning rate over the iterations</p>
<ul class="simple">
<li><p><strong>Learning Rate Decay</strong> - set as &gt; 0 to avoid mitigate oscillations,</p></li>
</ul>
</section>
<section id="training-epochs">
<h2>Training Epochs<a class="headerlink" href="#training-epochs" title="Permalink to this heading">#</a></h2>
<p>This is a good time to talk about stochastic gradient descent optimization, first let’s define some common terms,</p>
<ul class="simple">
<li><p><strong>Batch Gradient Descent</strong> - updates the model parameters after passing through all of the data</p></li>
<li><p><strong>Stochastic Gradient Descent</strong> - updates the model parameters over each sample data</p></li>
<li><p><strong>Mini-batch Gradient Descent</strong> - updates the model parameter after passing through a single batch</p></li>
</ul>
<p>With mini-batch gradient descent stochasticity is introduced through the use of subsets of the data, known as batches,</p>
<ul class="simple">
<li><p>for example, if we divide our 100 samples into 4 batches, then we iterate over each batch separately</p></li>
<li><p>we speed up the individual updates, fewer data are faster to calculate, but we introduce more error</p></li>
<li><p>this often helps the training explore for the global minimum and avoid getting stuck in local minimums and along ridges in the loss hypersurface</p></li>
</ul>
<p>Finally our last definition here,</p>
<ul class="simple">
<li><p><strong>epoch</strong> - is one pass over all of the data, so that would be 4 iterations of updating the model parameters if we have 4 mini-batches</p></li>
</ul>
<p>There are many other considerations that I will add later including,</p>
<ul class="simple">
<li><p>momentum</p></li>
<li><p>adaptive optimization</p></li>
</ul>
<p>Now let’s build the above artificial neural network by-hand and visualize the solution!</p>
<ul class="simple">
<li><p>this is by-hand so that you can see every calculation. I intentionally avoided using TensorFlow or PyTorch.</p></li>
</ul>
</section>
<section id="training-with-multiple-training-images">
<h2>Training with Multiple Training Images<a class="headerlink" href="#training-with-multiple-training-images" title="Permalink to this heading">#</a></h2>
<p>The backpropagation is based on a single sample, i.e., training image and paired response feature value; therefore, to train over multiple images we must cycle over the,</p>
<ul class="simple">
<li><p>forward pass</p></li>
<li><p>calculate error derivative</p></li>
<li><p>back propagate</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/trainingcnnbatch.png" style="display: block; margin: 0 auto; width: 100%;">
  <figcaption style="text-align: center;">Batch training process.</figcaption>
</figure>
<p>For each image the weights and biases gradients are stored. Then the gradients are summed over the images in the batch and this sum is applied with the learning rate to update the weights and biases.</p>
</section>
<section id="forward-pass">
<h2>Forward Pass<a class="headerlink" href="#forward-pass" title="Permalink to this heading">#</a></h2>
<p>For clarity, let’s walk through the convolutional neural network, starting with image input.</p>
<p>The input nodes receives the input from the image in to the convolution layer,</p>
<ul class="simple">
<li><p>node order is retained to preserve spatial, location information from the image</p></li>
</ul>
<p>For continuous feature images,</p>
<ul class="simple">
<li><p>the continuous predictor feature values are normalized to a min / max of [0,1] or [-1,1] to improve sensitivity for the specific activation function</p></li>
<li><p>for color images, the RGB channels may be each normalized and included as 3 input channels</p></li>
</ul>
<p>For categorical feature images,</p>
<ul class="simple">
<li><p>for binary, cardinality of 2, the values may be reassigned by indicator transform to 0 or 1</p></li>
<li><p>for cardinality &gt; 2, one-hot-encoding may be applied resulting in <span class="math notranslate nohighlight">\(k\)</span> input channels</p></li>
</ul>
<p>See the feature transformation chapter for more details about these transformations.</p>
<p>Now we pass through a convolution layer, with convolution and activation, resulting in a new feature map.</p>
<figure style="text-align: center;">
  <img src="_static/CNN/walkconv.png" style="display: block; margin: 0 auto; width: 50%;">
  <figcaption style="text-align: center;">Walk-through of our by-hand convolutional neural network, through the convolution layer.</figcaption>
</figure>
<ul class="simple">
<li><p>take linearly weighted combinations based on the kernel(s) of input image or previous feature map, add a bias term and then nonlinearly transform the result, this transform is call the activation function, <span class="math notranslate nohighlight">\(\alpha\)</span>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
C_{j_{\text{in}}} = \sum_{i=1}^{n} \left( K_{i+5} \cdot I_{j-8} \right) + b_{conv}
\]</div>
<p>where, <span class="math notranslate nohighlight">\(K_6\)</span>, <span class="math notranslate nohighlight">\(K_7\)</span> and <span class="math notranslate nohighlight">\(K_8\)</span> are kernel weights, <span class="math notranslate nohighlight">\(b_{conv}\)</span> is the kernel bias, and the <span class="math notranslate nohighlight">\(I\)</span> are the input nodes.</p>
<p>Please, excuse the strange indices in the equation, I like using unique node integers for every node to avoid mixing up nodes in my notes and codes, but this does complicate the index assignments.</p>
<div class="math notranslate nohighlight">
\[
C_{9_{\text{in}}} = I_1 \cdot K_6 + I_2 \cdot K_7 + I_3 \cdot K_8 + b_{\text{conv}}
\]</div>
<div class="math notranslate nohighlight">
\[
C_{10_{\text{in}}} = I_2 \cdot K_6 + I_3 \cdot K_7 + I_4 \cdot K_8 + b_{\text{conv}}
\]</div>
<div class="math notranslate nohighlight">
\[
C_{11_{\text{in}}} = I_3 \cdot K_6 + I_4 \cdot K_7 + I_5 \cdot K_8 + b_{\text{conv}}
\]</div>
<p>then nonlinear activation is applied to each,</p>
<div class="math notranslate nohighlight">
\[
C_j = \alpha \left( C_{j_{in}} \right) \quad j = 9, \ldots 11
\]</div>
<p>Now we proceed from the feature map through the artificial neural network to the output.</p>
<p>This is just a standard artificial neural network that takes the feature map flattened and moves it to the output.</p>
<ul class="simple">
<li><p>in this example for brevity we show the simplest possible artificial neural network, i.e., the next layer after the feature map is the output. More complicated architectures with hidden layers are often applied.</p></li>
<li><p>also, since our images are 1D we do not require a flattening step</p></li>
</ul>
<p>The output node is a standard output node from an artificial neural network,</p>
<ul class="simple">
<li><p>input is a linear combination of the nodes from the previous layer with an added bias term.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
O_{j_{\text{in}}} = \sum_{j=1}^{m} \left( \lambda_{i,j} \cdot H_i \right) + b_j
\]</div>
<p>and then an activation is applied,</p>
<div class="math notranslate nohighlight">
\[
O_j = \alpha \left( O_{j_{in}} \right)
\]</div>
<p>For the case of a regression model, with continuous response feature, linear or identity activation is applied,</p>
<div class="math notranslate nohighlight">
\[
O_j = \alpha \left( O_{j_{in}} \right) =  O_{j_{in}} 
\]</div>
<figure style="text-align: center;">
  <img src="_static/CNN/walkout1.png" style="display: block; margin: 0 auto; width: 30%;">
  <figcaption style="text-align: center;">Walk-through of our by-hand convolutional neural network, from feature map to the output for continuous output.</figcaption>
</figure>
<p>and for the case of a classification model, with categorical response feature, softmax activation is applied over <span class="math notranslate nohighlight">\(K\)</span> nodes equal to the cardinality of the response feature.</p>
<ul class="simple">
<li><p>the output is a probability for each category that honors non-negativity and closure constraints</p></li>
</ul>
<figure style="text-align: center;">
  <img src="_static/CNN/walkout2.png" style="display: block; margin: 0 auto; width: 30%;">
  <figcaption style="text-align: center;">Walk-through of our by-hand convolutional neural network, from feature map to the output for categorical output.</figcaption>
</figure>
<div class="math notranslate nohighlight">
\[
O_j = g_k(O_{j_{\text{in}}}) = \frac{e^{O_{j_{\text{in}}}}}{\sum_{\iota=1}^{K} e^{O_{\iota_{\text{in}}}}}
\]</div>
</section>
<section id="import-required-packages">
<h2>Import Required Packages<a class="headerlink" href="#import-required-packages" title="Permalink to this heading">#</a></h2>
<p>We will also need some standard packages. These should have been installed with Anaconda 3.</p>
<ul class="simple">
<li><p>recall our goal is to build a convolutional neural network by-hand with only basic math and array operations, so we only need NumPy along with matplotlib for plotting.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span><span class="p">,</span> <span class="n">AutoLocator</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                            <span class="c1"># set axes and grids in the background for all plots</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">13</span>
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‘python -m pip install [package-name]’. More assistance is available with the respective package docs.</p>
</section>
<section id="declare-functions">
<h2>Declare Functions<a class="headerlink" href="#declare-functions" title="Permalink to this heading">#</a></h2>
<p>Here’s the functions to make, train and visualize our convoluational neural network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks   </span>

<span class="k">def</span> <span class="nf">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>     <span class="c1"># Calculate the differences</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>    <span class="c1"># Calculate the angle in radians</span>
    <span class="c1">#angle_degrees = math.degrees(angle_radians)    # Convert the angle to degrees</span>
    <span class="k">return</span> <span class="n">angle_rads</span>
    
<span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="n">pto</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">pto</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">pto</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offsetx</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xo</span><span class="p">,</span> <span class="n">x_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offset_arrx</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">,</span><span class="n">size</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">x_arr</span> <span class="o">=</span> <span class="n">x_new</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_new</span><span class="p">,</span> <span class="n">x_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offsety</span><span class="p">(</span><span class="n">yo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">yo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">yo</span><span class="p">,</span> <span class="n">y_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offset_arry</span><span class="p">(</span><span class="n">yo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">,</span><span class="n">size</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">yo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">y_arr</span> <span class="o">=</span> <span class="n">y_new</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">y_new</span><span class="p">,</span> <span class="n">y_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lintx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">linty</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">lint_intx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xs</span><span class="p">,</span><span class="n">xe</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_inty</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">ys</span><span class="p">,</span><span class="n">ye</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_int_arrx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">line_angle_rads</span> <span class="o">=</span> <span class="n">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">x_arr</span> <span class="o">=</span> <span class="n">xe</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">line_angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xe</span><span class="p">,</span><span class="n">x_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_int_arry</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="n">line_angle_rads</span> <span class="o">=</span> <span class="n">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">y_arr</span> <span class="o">=</span> <span class="n">ye</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">line_angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">ye</span><span class="p">,</span><span class="n">y_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">as_si</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndp</span><span class="p">):</span> <span class="c1"># from xnx on StackOverflow https://stackoverflow.com/questions/31453422/displaying-numbers-with-x-instead-of-e-scientific-notation-in-matplotlib </span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;{x:0.</span><span class="si">{ndp:d}</span><span class="s1">e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ndp</span><span class="o">=</span><span class="n">ndp</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">{m:s}</span><span class="s1">\times 10^{{</span><span class="si">{e:d}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-simple-by-hand-cnn">
<h2>The Simple By-hand CNN<a class="headerlink" href="#the-simple-by-hand-cnn" title="Permalink to this heading">#</a></h2>
<p>I wrote this code to specify a simple CNN,</p>
<ul class="simple">
<li><p>five input nodes, 1 convolution layer with a kernel of 3 resulting in a 3 nodes in the feature map and 1 output node</p></li>
</ul>
<p>and to train the CNN by iteratively performing the forward calculation and backpropagation. I calculate:</p>
<ul class="simple">
<li><p>the error and then propagate it to each node</p></li>
<li><p>solve for the partial derivatives of the error with respect to each weight and bias</p></li>
</ul>
<p>all weights, biases and partial derivatives for all epoch are recorded in vectors for plotting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initial CNN trains on one sample</span>
<span class="n">x1</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">x2</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="n">x3</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span> <span class="n">x4</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span> <span class="n">x5</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># training data</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># learning rate</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">nepoch</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">w6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">w9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">bconv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">b12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">k6i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k6i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k6i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">k7i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k7i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k7i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">k8i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k8i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k8i5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">dk6i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk6i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk6i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dk7i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk7i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk7i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dk8i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk8i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk8i5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">c9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">c10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">c11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">d9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">o12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">dw6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dw9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dbconv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">db12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">d6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> 
<span class="n">d19</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> 

<span class="c1"># initialize the weights - Xavier Weight Initialization </span>
<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">))</span> <span class="c1"># lower and upper bound for the weights, uses inputs to node</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(3.0 + 2.0)), (sqrt(6.0) / sqrt(3.0 + 2.0)) # Normalized Xavier weights, integrates ouputs also</span>
<span class="n">w6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w8</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>

<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(2.0 + 1.0)), (sqrt(6.0) / sqrt(2.0 + 1.0)) # Normalized Xavier weights, integrates ouputs also</span>

<span class="n">w9</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w10</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>     
<span class="n">w11</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>     

<span class="c1">#b4[0] = np.random.random(); b5[0] = np.random.random(); b6[0] = np.random.random()</span>
<span class="n">bconv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
<span class="n">b12</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="c1"># small random value  </span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nepoch</span><span class="p">):</span>

<span class="c1"># forward pass of model</span>
    <span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
    <span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x4</span> <span class="o">+</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
    <span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x4</span> <span class="o">+</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x5</span> <span class="o">+</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
    <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    
    <span class="n">o12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># back propagate the error through the nodes</span>
    <span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">o12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="c1"># identity activation o at o12 - switched substraction on May 27, 2025</span>
    <span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   <span class="c1"># propagate to the front feature map layer</span>
    <span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">dk6i1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">*</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk7i2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">*</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk8i3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">*</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
    <span class="n">dk6i2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">*</span><span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk7i3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">*</span><span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk8i4</span> <span class="o">=</span> <span class="n">x4</span><span class="o">*</span><span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
    <span class="n">dk6i3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">*</span><span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk7i4</span> <span class="o">=</span> <span class="n">x4</span><span class="o">*</span><span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk8i5</span> <span class="o">=</span> <span class="n">x5</span><span class="o">*</span><span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 

    <span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk6i1</span> <span class="o">+</span> <span class="n">dk6i2</span> <span class="o">+</span> <span class="n">dk6i3</span>
    <span class="n">d7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk7i2</span> <span class="o">+</span> <span class="n">dk7i3</span> <span class="o">+</span> <span class="n">dk7i4</span>
    <span class="n">d8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk8i3</span> <span class="o">+</span> <span class="n">dk8i4</span> <span class="o">+</span> <span class="n">dk8i5</span>
    
<span class="c1"># calculate the change in weights</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nepoch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dw6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d7</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">dw9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">dbconv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="p">(</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">db12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dw6</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dw7</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dw8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dw9</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dw10</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dw11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dbconv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">db12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-by-hand-cnn">
<h2>Visualize By-hand CNN<a class="headerlink" href="#visualize-by-hand-cnn" title="Permalink to this heading">#</a></h2>
<p>Let’s visualize our convolutional neural network.</p>
<ul class="simple">
<li><p>note, I will used this code latter to make interactive dashboards.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xin</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">yin_range</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">nin</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">kcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">]</span>
<span class="n">xin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.5</span><span class="p">])</span>
<span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span><span class="p">])</span>
<span class="n">cin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">])</span>
<span class="n">kx</span> <span class="o">=</span> <span class="mf">0.6</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="c1">#plt.gca().set_axis_off()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xin</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">eq1</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$X_{{</span><span class="si">{}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">eq2</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$X_{{</span><span class="si">{}</span><span class="s2">}} = </span><span class="si">{}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">eq3</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$I_{{</span><span class="si">{}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">xpos</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">nin</span><span class="p">)</span> <span class="o">*</span> <span class="n">yin_range</span> 
    <span class="n">circle_i1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.015</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
    <span class="n">circle_i1b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1b</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq1</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq2</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="n">xpos</span><span class="p">],[</span><span class="n">ypos</span><span class="p">,</span><span class="n">ypos</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="n">xpos</span><span class="o">-</span><span class="mf">0.07</span><span class="p">],[</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.01</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="o">-</span><span class="mf">0.07</span><span class="p">,</span><span class="n">xpos</span><span class="o">-</span><span class="mf">0.08</span><span class="p">],[</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.02</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq3</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

<span class="k">for</span> <span class="n">iconv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>  
    <span class="n">xpos</span> <span class="o">=</span> <span class="n">kx</span><span class="o">+</span><span class="n">iconv</span><span class="o">*</span><span class="mf">0.2</span><span class="p">;</span>
    <span class="n">ytop</span> <span class="o">=</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="p">(</span><span class="n">iconv</span><span class="o">/</span><span class="n">nin</span><span class="p">)</span><span class="o">*</span><span class="n">yin_range</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">nin</span><span class="p">)</span> <span class="o">*</span> <span class="n">yin_range</span>
    <span class="n">ybot</span> <span class="o">=</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="p">(</span><span class="n">iconv</span><span class="o">/</span><span class="n">nin</span><span class="p">)</span><span class="o">*</span><span class="n">yin_range</span> <span class="o">-</span> <span class="p">((</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">nin</span><span class="p">)</span> <span class="o">*</span> <span class="n">yin_range</span>  
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.12</span><span class="p">,</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.12</span><span class="p">],[</span><span class="n">ytop</span><span class="o">+</span><span class="mf">0.005</span><span class="p">,</span><span class="n">ybot</span><span class="o">+</span><span class="mf">0.005</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="p">(</span><span class="n">ki</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">eq4</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$K_{{</span><span class="si">{}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ik</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ypos</span> <span class="o">=</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="p">(</span><span class="n">iconv</span><span class="o">/</span><span class="n">nin</span><span class="p">)</span><span class="o">*</span><span class="n">yin_range</span> <span class="o">-</span> <span class="p">((</span><span class="n">ik</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">nin</span><span class="p">)</span> <span class="o">*</span> <span class="n">yin_range</span>
        <span class="n">circle_i1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.015</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="n">kcolors</span><span class="p">[</span><span class="n">ik</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">);</span>
        <span class="n">circle_i1b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">190</span><span class="p">);</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1b</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq4</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span><span class="n">xpos</span><span class="p">],[</span><span class="n">ypos</span><span class="p">,</span><span class="n">ypos</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="p">,</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.12</span><span class="p">],[</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.005</span><span class="p">,</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.005</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
        <span class="n">eq8</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$I_{{</span><span class="si">{}</span><span class="s2">}} \cdot K_{{</span><span class="si">{}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">iconv</span><span class="p">)</span><span class="o">+</span><span class="n">ik</span><span class="p">,</span><span class="n">ik</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>        
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq8</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="p">(</span><span class="n">ci</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">eq5</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$C_{{</span><span class="si">{}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">xpos</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">;</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="p">((</span><span class="n">ic</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="mf">0.07</span>
    <span class="n">circle_i1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.015</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">);</span>
    <span class="n">circle_i1b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">190</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1b</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq5</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
    <span class="c1">#plt.plot([0.4,x],[y,y],color=&#39;black&#39;,lw=1,zorder=1)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],[</span><span class="n">ypos</span><span class="p">,</span><span class="n">yin_range</span> <span class="o">-</span> <span class="p">((</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="mf">0.07</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">kx</span><span class="o">+</span><span class="p">(</span><span class="n">ic</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="o">+</span><span class="mf">0.12</span><span class="p">,</span><span class="n">xpos</span><span class="p">],[</span><span class="n">ypos</span><span class="p">,</span><span class="n">ypos</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>


<span class="n">eq6</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$O_{{</span><span class="si">{}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">eq7</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$Y_{{</span><span class="si">{}</span><span class="s2">}} = </span><span class="si">{}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">yout</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
<span class="n">xpos</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="p">((</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">yin_range</span> <span class="o">-</span> <span class="mf">0.07</span>
<span class="n">circle_i1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.015</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">);</span>
<span class="n">circle_i1b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">190</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1b</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq6</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq7</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="p">,</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.2</span><span class="p">],[</span><span class="n">ypos</span><span class="p">,</span><span class="n">ypos</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="p">,</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.13</span><span class="p">],[</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.01</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.13</span><span class="p">,</span><span class="n">xpos</span><span class="o">+</span><span class="mf">0.12</span><span class="p">],[</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span><span class="n">ypos</span><span class="o">+</span><span class="mf">0.02</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">eq6</span><span class="p">,</span> <span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bd6f0d76fef9a0c1d4062d2fed4028a098a6ba3f59c0dff50e67370b90502ba7.png" src="_images/bd6f0d76fef9a0c1d4062d2fed4028a098a6ba3f59c0dff50e67370b90502ba7.png" />
</div>
</div>
<p>and now we can visualize the model training results including,</p>
<ul class="simple">
<li><p>weights and biases vs. training epochs</p></li>
<li><p>CNN prediction vs. training epochs</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">o12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{y}</span><span class="s1">$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{y}</span><span class="s1">$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CNN - Prediction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w6</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightcoral&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$k_6$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$k_7$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$k_8$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">bconv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$b_0$&#39;</span><span class="p">)</span> 
<span class="c1"># plt.plot(np.arange(1,nepoch+1,1),w25,color=&#39;blue&#39;,label = r&#39;$\lambda_{2,5}$&#39;) </span>
<span class="c1"># plt.plot(np.arange(1,nepoch+1,1),w35,color=&#39;darkblue&#39;,label = r&#39;$\lambda_{3,5}$&#39;)</span>
<span class="c1"># plt.plot(np.arange(1,nepoch+1,1),w46,color=&#39;orange&#39;,label = r&#39;$\lambda_{4,6}$&#39;)</span>
<span class="c1"># plt.plot(np.arange(1,nepoch+1,1),w56,color=&#39;darkorange&#39;,label = r&#39;$\lambda_{5,6}$&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{y}</span><span class="s1">$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CNN - Kernel&#39;</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_</span><span class="si">{9}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_</span><span class="si">{10}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w11</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_</span><span class="si">{11}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">b12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$b_</span><span class="si">{12}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{y}</span><span class="s1">$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CNN - ANN Weights&#39;</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4cea6b946d67f8e2cb6605415803c148ac63ebfb43f8034a7285880405bb88d3.png" src="_images/4cea6b946d67f8e2cb6605415803c148ac63ebfb43f8034a7285880405bb88d3.png" />
</div>
</div>
<p>Of course, the results above are not very practical, in fact we need our convolutional neural network to generalize by learning over many images, not just 1 as demonstrated above. Let’s,</p>
<ul class="simple">
<li><p>make a suite of synthetic image data with labels</p></li>
<li><p>apply the batch training method to train on this ensemble of training images.</p></li>
</ul>
</section>
<section id="make-synthetic-training-images-with-label">
<h2>Make Synthetic Training Images with Label<a class="headerlink" href="#make-synthetic-training-images-with-label" title="Permalink to this heading">#</a></h2>
<p>The following code makes random configurations of 5 points with variable slope and additive noise and then retains the slope linear regression model of the data as the label.</p>
<p>The workflow inludes these steps,</p>
<ol class="arabic simple">
<li><p>draw a random slope, <span class="math notranslate nohighlight">\(m^{\ell} \sim U\left[-2.0,2.0\right]\)</span></p></li>
<li><p>sample 5 values on this slope centered at the middle of the values</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
Z^{\ell} = \left(x-2.5\right)*m^{\ell} 
\]</div>
<ol class="arabic simple" start="4">
<li><p>add a random errror to the values, <span class="math notranslate nohighlight">\(\epsilon \sim U\left[-\Delta,\Delta\right]\)</span></p></li>
</ol>
<div class="math notranslate nohighlight">
\[
Z_{\epsilon}^{\ell} = \left(x-2.5\right)*m^{\ell} + U^{-1}\left[-\Delta,\Delta\right](p^{\ell})
\]</div>
<ol class="arabic simple" start="5">
<li><p>calculate the linear regression model slope to retain as the response feature</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
m = \frac{&lt;Z_{\epsilon}^{\ell} \cdot x&gt;}{&lt;x \cdot x&gt;}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nsample</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">nnodes</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">ymat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsample</span><span class="p">);</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nnodes</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">Xmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nsample</span><span class="p">,</span><span class="n">nnodes</span><span class="p">])</span>
<span class="k">for</span> <span class="n">isample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsample</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="n">Xmat</span><span class="p">[</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="n">delta</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">nnodes</span><span class="p">)</span>
    <span class="n">ymat</span><span class="p">[</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Xmat</span><span class="p">[</span><span class="n">isample</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">isample</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="k">for</span> <span class="n">isample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsample</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Xmat</span><span class="p">[</span><span class="n">isample</span><span class="p">],</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Xmat</span><span class="p">[</span><span class="n">isample</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">custom_positions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">5.2</span><span class="p">]</span>
    <span class="n">custom_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ymat</span><span class="p">[</span><span class="n">isample</span><span class="p">],</span><span class="mi">2</span><span class="p">),[</span><span class="mf">5.2</span><span class="p">,</span><span class="n">Xmat</span><span class="p">[</span><span class="n">isample</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">custom_positions</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">custom_labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">5.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span><span class="mf">4.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Synthetic 1D Images and Labels&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/60bea9aeec98af43e38abc10f6ce1302ee8c10ff095a8bfdef8fb4231fc1be32.png" src="_images/60bea9aeec98af43e38abc10f6ce1302ee8c10ff095a8bfdef8fb4231fc1be32.png" />
</div>
</div>
</section>
<section id="training-the-simple-cnn-on-many-training-images">
<h2>Training the Simple CNN on Many Training Images<a class="headerlink" href="#training-the-simple-cnn-on-many-training-images" title="Permalink to this heading">#</a></h2>
<p>I modified the code above to loops over the batch of training images, sums the error gradients and updates over all the weights and biases for each training epoch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>                                     <span class="c1"># CNN trains over multiple samples</span>

<span class="n">lr</span> <span class="o">=</span> <span class="mf">0.2</span>                                                 <span class="c1"># learning rate</span>
<span class="n">nepoch</span> <span class="o">=</span> <span class="mi">1000</span>                                    <span class="c1"># number of training epochs</span>

<span class="n">w6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>  <span class="c1"># initialize the CNN weights</span>
<span class="n">w9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">bconv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">b12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">k6i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k6i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k6i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">k7i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k7i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k7i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">k8i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k8i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">k8i5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">dk6i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk6i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk6i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dk7i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk7i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk7i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dk8i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk8i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dk8i5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">c9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">c10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">c11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">d9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">o12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">yhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">))</span>

<span class="n">dw6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">));</span> <span class="n">dw7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">));</span> <span class="n">dw8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">))</span>
<span class="n">dw9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">));</span> <span class="n">dw10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">));</span> <span class="n">dw11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">))</span>
<span class="n">dbconv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">));</span> <span class="n">db12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span><span class="n">nsample</span><span class="p">))</span>

<span class="n">d6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> 
<span class="n">d19</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> 

<span class="c1"># initialize the weights - Xavier Weight Initialization </span>
<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">))</span> <span class="c1"># lower and upper bound for the weights, uses inputs to node</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(3.0 + 2.0)), (sqrt(6.0) / sqrt(3.0 + 2.0)) # Normalized Xavier weights, integrates ouputs also</span>
<span class="n">w6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w8</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>

<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(2.0 + 1.0)), (sqrt(6.0) / sqrt(2.0 + 1.0)) # Normalized Xavier weights, integrates ouputs also</span>

<span class="n">w9</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w10</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>     
<span class="n">w11</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>     

<span class="c1">#b4[0] = np.random.random(); b5[0] = np.random.random(); b6[0] = np.random.random()</span>
<span class="n">bconv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
<span class="n">b12</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="c1"># small random value  </span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nepoch</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">isample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsample</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">x5</span> <span class="o">=</span> <span class="n">Xmat</span><span class="p">[</span><span class="n">isample</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ymat</span><span class="p">[</span><span class="n">isample</span><span class="p">]</span>

        <span class="c1"># forward pass of model</span>
        <span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
        <span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
     
        <span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x4</span> <span class="o">+</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
        <span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
     
        <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x4</span> <span class="o">+</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x5</span> <span class="o">+</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
        <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        
        <span class="n">o12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">yhat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">o12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
<span class="c1"># back propagate the error through the nodes</span>
        <span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">o12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="c1"># identity activation o at o12 - switched substraction on May 27, 2025</span>
        <span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   <span class="c1"># propagate to the front feature map layer</span>
        <span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
        <span class="n">dk6i1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">*</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk7i2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">*</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk8i3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">*</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">dk6i2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">*</span><span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk7i3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">*</span><span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk8i4</span> <span class="o">=</span> <span class="n">x4</span><span class="o">*</span><span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">dk6i3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">*</span><span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk7i4</span> <span class="o">=</span> <span class="n">x4</span><span class="o">*</span><span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dk8i5</span> <span class="o">=</span> <span class="n">x5</span><span class="o">*</span><span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
    
        <span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk6i1</span> <span class="o">+</span> <span class="n">dk6i2</span> <span class="o">+</span> <span class="n">dk6i3</span>
        <span class="n">d7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk7i2</span> <span class="o">+</span> <span class="n">dk7i3</span> <span class="o">+</span> <span class="n">dk7i4</span>
        <span class="n">d8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk8i3</span> <span class="o">+</span> <span class="n">dk8i4</span> <span class="o">+</span> <span class="n">dk8i5</span>
    
<span class="c1"># calculate the change in weights</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nepoch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dw6</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw7</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d7</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw8</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">dw9</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">c9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw10</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">c10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw11</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">dbconv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="p">(</span><span class="n">d9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">d10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">db12</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nepoch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dw6</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dw7</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dw8</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dw9</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dw10</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dw11</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bconv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dbconv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">db12</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now again we can visualize the model performance,</p>
<ul class="simple">
<li><p>predictions over all training images vs. training epochs</p></li>
<li><p>model weights and biases vs. training epochs</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="k">for</span> <span class="n">isample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsample</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">yhat</span><span class="p">[:,</span><span class="n">isample</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span><span class="p">(</span><span class="n">isample</span><span class="o">/</span><span class="n">nsample</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;y&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isample</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="n">ymat</span><span class="p">[</span><span class="n">isample</span><span class="p">],</span><span class="n">ymat</span><span class="p">[</span><span class="n">isample</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span><span class="p">(</span><span class="n">isample</span><span class="o">/</span><span class="n">nsample</span><span class="p">),</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{y}</span><span class="s1">$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CNN - Prediction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w6</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightcoral&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$k_6$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$k_7$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$k_8$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">bconv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$b_0$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{y}</span><span class="s1">$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CNN - Kernel&#39;</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_</span><span class="si">{9}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_</span><span class="si">{10}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w11</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_</span><span class="si">{11}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">b12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$b_</span><span class="si">{12}</span><span class="s1">$&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{y}</span><span class="s1">$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CNN - ANN Weights&#39;</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ba623428124e0113a09fcf1b71bb1dacaf21bee4f296116c527e30bf0e957edb.png" src="_images/ba623428124e0113a09fcf1b71bb1dacaf21bee4f296116c527e30bf0e957edb.png" />
</div>
</div>
</section>
<section id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this heading">#</a></h2>
<p>This was a basic treatment of convolutional neural networks. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos’ descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
</section>
<section id="about-the-author">
<h2>About the Author<a class="headerlink" href="#about-the-author" title="Permalink to this heading">#</a></h2>
<figure style="text-align: center;">
  <img src="_static/intro/michael_pyrcz_officeshot_jacket.jpg" style="display: block; margin: 0 auto; width: 70%;">
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael’s university lectures are available on his <a class="reference external" href="https://www.youtube.com/&#64;GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael’s work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
</section>
<section id="want-to-work-together">
<h2>Want to Work Together?<a class="headerlink" href="#want-to-work-together" title="Permalink to this heading">#</a></h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I’d be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz&#37;&#52;&#48;austin&#46;utexas&#46;edu">mpyrcz<span>&#64;</span>austin<span>&#46;</span>utexas<span>&#46;</span>edu</a>.</p></li>
</ul>
<p>I’m always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="MachineLearning_ANN.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Artificial Neural Networks</p>
      </div>
    </a>
    <a class="right-next"
       href="MachineLearning_autoencoder.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Autoencoder</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts-in-common-with-artificial-neural-networks">Concepts in Common with Artificial Neural Networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolutional-neural-networks-concepts">Convolutional Neural Networks Concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#image-data-with-artificial-neural-networks">Image Data with Artificial Neural Networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regularization-for-cnns">Regularization for CNNs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-blocks-for-cnns">Building Blocks for CNNs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#activation-functions">Activation Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pooling">Pooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-wise-pooling">Depth-wise Pooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#common-cnn-architecture">Common CNN Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#by-hand-cnn-architecture">By-Hand CNN Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-model-parameters">Training Model Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backpropagation">Backpropagation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updating-model-parameters">Updating Model Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-epochs">Training Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-with-multiple-training-images">Training with Multiple Training Images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-pass">Forward Pass</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-required-packages">Import Required Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#declare-functions">Declare Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-simple-by-hand-cnn">The Simple By-hand CNN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-by-hand-cnn">Visualize By-hand CNN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-synthetic-training-images-with-label">Make Synthetic Training Images with Label</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-simple-cnn-on-many-training-images">Training the Simple CNN on Many Training Images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comments">Comments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-the-author">About the Author</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#want-to-work-together">Want to Work Together?</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael J. Pyrcz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024 CC BY-NC-ND 4.0.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>